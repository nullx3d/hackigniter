trigger:
- master

pool: Default

steps:

- task: FortifySCA@7
  inputs:
    applicationType: 'other'
    fortifyBuildId: 'php'
    fortifyScanType: 'LocalScan'
    runFortifyUpload: true
    fortifyServerName: 'ssc test'
    fortifyApplicationName: 'hackigniter'
    fortifyApplicationVersion: '1'


- powershell: |
    $fprFilePath = "$(Agent.TempDirectory)/$(Build.BuildId).fpr"
    $fprOutput = fprutility -information -search -query "[fortify priority order]:low" -project $fprFilePath
    if ($fprOutput -contains "of") {
      exit 1
    }